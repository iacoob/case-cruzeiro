config { type: "assertion" }

SELECT
  lead_id,
  lead_created_at,
  conversion_ts,
  days_to_convert
FROM ${ref("gold_case", "fact_lead_journey")}
WHERE
  (converted_flag = 1 AND conversion_ts IS NULL)
  OR (converted_flag = 0 AND conversion_ts IS NOT NULL)
  OR (conversion_ts IS NOT NULL AND conversion_ts < lead_created_at)
  OR (days_to_convert IS NOT NULL AND days_to_convert < 0)
  OR (days_to_convert IS NOT NULL AND days_to_convert > 3650) -- 10 anos: sanity upper bound